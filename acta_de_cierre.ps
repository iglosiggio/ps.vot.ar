%!PS-Adobe-3.0
%%Creator: Ignacio E. Losiggio
%%CreationDate: Wed Sep 20 11:23:00 2017
%%Pages: 2
%%DocumentData: Clean7Bit
%%LanguageLevel: 2
%%DocumentMedia: A4 595 842 0 () ()
%%BoundingBox: 20 40 575 802
%%EndComments

/xpos 20 def
/ypos 802 def

/newline {
  /ypos ypos fontsize sub def
  ypos 40 lt {
    % si me fui de la pagina cambio de columna
    /xpos xpos 300 add def
    /ypos 802 def
  } if
  xpos ypos moveto
} def

% helpers para la fecha

% collection key getbehind (collection key get) collection
/getbehind {
  1 index 3 1 roll get exch
} bind def

/arraymap {
  [ 3 1 roll forall ]
} bind def

%robado de https://en.wikibooks.org/wiki/PostScript_FAQ#How_to_concatenate_strings.3F
/concatstringarray  %  [(a) (b) ... (z)] --> (ab...z)  
{ 0 1 index { length add } forall string     
  0 3 2 roll      
  { 3 copy putinterval
    length add 
  }
  forall pop  
} bind def

% Sacar la fecha actual
/ahoramesmo {
  (%Calendar%) /IODevice resourcestatus
  3 1 roll pop pop
  {
    (%Calendar%) currentdevparams
    dup /DateTime known
    { /DateTime get }
    { [ exch 
        /Day getbehind (/) exch /Month getbehind (/) exch /Year getbehind
        ( ) exch
        /Hour getbehind (:) exch /Minute getbehind (:) exch /Second get
      ] { 128 string cvs } arraymap concatstringarray } ifelse
  }
  { (Not available) } ifelse
} def


/Courier findfont 48 scalefont setfont
40 780 moveto
(Acta de cierre) show
/Courier findfont 24 scalefont setfont
40 780 24 sub moveto
(Fecha de cierre: ) show ahoramesmo show
40 780 48 sub moveto
(Maquina de voto: Impresora) show
40 780 72 sub moveto
(          Lugar: ekoparty2017) show
40 780 120 sub moveto

/votos where {
  pop % quito el diccionario, si existe no me importa
  ( Cant. de votos: ) show
  0 votos { type /nulltype ne { 1 add } if } forall 10 string cvs show
} if
showpage

/fontsize 8 def
/Helvetica findfont fontsize scalefont setfont

xpos ypos moveto

/votos where {
  pop votos {
    dup type /arraytype eq
    {
      dup 0 get show
      xpos 160 add  ypos moveto
      dup 1 get show
      newline
    } if % si el voto es valido lo imprimo (sino probablemente no se asigno)
  } forall
  showpage
} if
%%Trailer
%%EOF
